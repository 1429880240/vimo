"use strict";function _classCallCheck(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScrollView=void 0;var _createClass=function(){function t(t,l){for(var e=0;e<l.length;e++){var i=l[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(l,e,i){return e&&t(l.prototype,e),i&&t(l,i),l}}(),_util=require("../../util/util"),SCROLL_END_DEBOUNCE_MS=80,FRAME_MS=1e3/60,EVENT_OPTS={passive:!0},ScrollView=exports.ScrollView=function(){function t(){_classCallCheck(this,t),this.isScrolling=!1,this.initialized=!1,this.scrollStart=function(t){},this.scroll=function(t){},this.scrollEnd=function(t){},this.transform=window.VM&&window.VM.platform&&window.VM.platform.css?window.VM.platform.css.transform:"webkitTransform",this._el=null,this._lsn=null,this._endTmr=null,this.ev={timeStamp:0,scrollTop:0,scrollLeft:0,scrollHeight:0,scrollWidth:0,contentHeight:0,contentWidth:0,contentTop:0,contentBottom:0,startY:0,startX:0,deltaY:0,deltaX:0,velocityY:0,velocityX:0,directionY:"down",directionX:null,contentElement:null,fixedElement:null,scrollElement:null,headerElement:null,footerElement:null}}return _createClass(t,[{key:"init",value:function(t){this.initialized||(this.initialized=!0,console.assert(t,"scroll-view, element can not be null"),this._el=t,this.enableNativeScrolling())}},{key:"enableNativeScrolling",value:function(){function t(t){function n(){l.isScrolling=!1,e.velocityY=e.velocityX=0,l.scrollEnd(e),l._endTmr=null}if(e.timeStamp=t.timeStamp,e.scrollTop=l.getTop(),e.scrollLeft=l.getLeft(),l.isScrolling||(l.isScrolling=!0,e.startY=e.scrollTop,e.startX=e.scrollLeft,e.velocityY=e.velocityX=0,e.deltaY=e.deltaX=0,i.length=0,l.scrollStart(e)),i.push(e.scrollTop,e.scrollLeft,e.timeStamp),i.length>3){e.deltaY=e.scrollTop-e.startY,e.deltaX=e.scrollLeft-e.startX;for(var o=i.length-1,r=o,s=e.timeStamp-100,c=o;c>0&&i[c]>s;c-=3)r=c;if(r!==o){var a=i[o]-i[r],u=i[r-2]-i[o-2],f=i[r-1]-i[o-1];e.velocityY=u/a*FRAME_MS,e.velocityX=f/a*FRAME_MS,e.directionY=u>0?"up":"down",e.directionX=f>0?"left":"right"}}l.scroll(e),window.clearTimeout(l._endTmr),l._endTmr=window.setTimeout(n,SCROLL_END_DEBOUNCE_MS)}if(this._el){var l=this,e=l.ev,i=[];l._lsn&&l._lsn(),l._lsn=(0,_util.registerListener)(l._el,"scroll",t,EVENT_OPTS)}}},{key:"getTop",value:function(){return this._el.scrollTop}},{key:"getLeft",value:function(){return this._el.scrollLeft}},{key:"setTop",value:function(t){this._el.scrollTop=t}},{key:"setLeft",value:function(t){this._el.scrollLeft=t}},{key:"scrollTo",value:function(){function t(){if(d++,!r._el||_||d>u)return r.isScrolling=!1,s.style[f]="",void n();v=(new Date).getTime();var o=Math.min(1,(v-h)/i),m=--o*o*o+1;c!==e&&r.setTop(m*(e-c)+c),a!==l&&r.setLeft(Math.floor(m*(l-a)+a)),m<1?(0,_util.nativeRaf)(t):(_=!0,r.isScrolling=!1,n())}var l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2],n=arguments[3],o=void 0;void 0===n&&(o=new Promise(function(t){n=t}));var r=this,s=r._el;if(!s)return n(),o;if(i<32)return r.setTop(e),r.setLeft(l),n(),o;var c=s.scrollTop,a=s.scrollLeft,u=i/16+100,f=r.transform,h=void 0,v=void 0,d=0,_=!1;return r.isScrolling=!0,h=(new Date).getTime(),(0,_util.nativeRaf)(t),o}},{key:"scrollToTop",value:function(t){return this.scrollTo(0,0,t)}},{key:"scrollToBottom",value:function(t){var l=0;return this._el&&(l=this._el.scrollHeight-this._el.clientHeight),this.scrollTo(0,l,t)}},{key:"stop",value:function(){this.isScrolling=!1}},{key:"destroy",value:function(){this.stop(),this._endTmr&&window.clearTimeout(self._endTmr),this._lsn&&this._lsn(),this.scrollStart&&(this.scrollStart=null),this.scroll&&(this.scrollStart=null),this.scrollEnd&&(this.scrollStart=null);var t=this.ev;t.contentElement=t.fixedElement=t.scrollElement=t.headerElement=null,this._lsn=this._el=this.ev=t=null}}]),t}();
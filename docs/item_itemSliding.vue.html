<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>item/itemSliding.vue - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Component_Content.html">Component/Content</a><ul class='methods'><li data-type='method'><a href="module-Component_Content.html#~getContentDimensions">getContentDimensions</a></li><li data-type='method'><a href="module-Component_Content.html#~getScrollElement">getScrollElement</a></li><li data-type='method'><a href="module-Component_Content.html#~onScrollElementTransitionEnd">onScrollElementTransitionEnd</a></li><li data-type='method'><a href="module-Component_Content.html#~resize">resize</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollTo">scrollTo</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollToBottom">scrollToBottom</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollToTop">scrollToTop</a></li><li data-type='method'><a href="module-Component_Content.html#~setScrollElementStyle">setScrollElementStyle</a></li></ul></li><li><a href="module-Component_Img.html">Component/Img</a></li><li><a href="module-Component_List.html">Component/List</a><ul class='methods'><li data-type='method'><a href="module-Component_List.html#~closeSlidingItems%25E6%259A%2582%25E6%2597%25B6%25E4%25B8%258D%25E5%258F%25AF%25E7%2594%25A8">closeSlidingItems </a></li></ul></li><li><a href="module-Menu.html">Menu</a><ul class='methods'><li data-type='method'><a href="module-Menu.html#~close">close</a></li><li data-type='method'><a href="module-Menu.html#~open">open</a></li><li data-type='method'><a href="module-Menu.html#~taggle">taggle</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="global.html#event:event">event</a></li><li><a href="module-Menu.html#~event:onMenuClosed">onMenuClosed</a></li><li><a href="module-Menu.html#~event:onMenuClosing">onMenuClosing</a></li><li><a href="module-Menu.html#~event:onMenuOpen">onMenuOpen</a></li><li><a href="global.html#event:onScroll">onScroll</a></li><li><a href="global.html#event:onScrollEnd">onScrollEnd</a></li><li><a href="global.html#event:onScrollStart">onScrollStart</a></li></ul><h3>Global</h3><ul><li><a href="global.html#close">close</a></li><li><a href="global.html#dismiss">dismiss</a></li><li><a href="global.html#getAnInstance">getAnInstance</a></li><li><a href="global.html#getModalInstance">getModalInstance</a></li><li><a href="global.html#Input/Textarea">Input/Textarea</a></li><li><a href="global.html#isActive">isActive</a></li><li><a href="global.html#lines">lines</a></li><li><a href="global.html#message">message</a></li><li><a href="global.html#nameClass">nameClass</a></li><li><a href="global.html#NAVIGATION_STACK">NAVIGATION_STACK</a></li><li><a href="global.html#normalButtons">normalButtons</a></li><li><a href="global.html#open">open</a></li><li><a href="global.html#POI%25E6%2590%259C%25E7%25B4%25A2">POI 搜索</a></li><li><a href="global.html#prepareInstance">prepareInstance</a></li><li><a href="global.html#prepareToast">prepareToast</a></li><li><a href="global.html#present">present</a></li><li><a href="global.html#recordMenuInstance">recordMenuInstance</a></li><li><a href="global.html#spinner">spinner</a></li><li><a href="global.html#title">title</a></li><li><a href="global.html#Toggle">Toggle</a></li><li><a href="global.html#toggle">toggle</a></li><li><a href="global.html#%25E5%2588%25A4%25E6%2596%25AD%25E6%2598%25AF%25E5%2590%25A6%25E5%25AE%2589%25E8%25A3%2585app">判断是否安装app</a></li><li><a href="global.html#%25E5%2590%25AF%25E5%258A%25A8app">启动app</a></li><li><a href="global.html#%25E5%259C%25B0%25E5%259B%25BE%25E5%25AE%259A%25E4%25BD%258D">地图定位</a></li><li><a href="global.html#%25E5%25A4%2584%25E7%2590%2586range%25E6%258C%2589%25E9%2592%25AE%25E4%25B8%259A%25E5%258A%25A1%25E7%259A%2584%25E7%25BB%2584%25E4%25BB%25B6%25E5%25AF%25B9%25E5%25A4%2596%25E4%25BA%258B%25E4%25BB%25B6:onIncreaseonDecrease">处理range按钮业务的组件


对外事件:
onIncrease
onDecrease</a></li><li><a href="global.html#%25E8%258E%25B7%25E5%258F%2596%25E5%25BD%2593%25E5%2589%258D%25E7%25BD%2591%25E7%25BB%259C%25E7%25B1%25BB%25E5%259E%258B">获取当前网络类型</a></li><li><a href="global.html#%25E8%25AE%25BE%25E7%25BD%25AE%25E5%25AF%25BC%25E8%2588%25AA%25E6%25A0%258F%25E9%25A2%259C%25E8%2589%25B2">设置导航栏颜色</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">item/itemSliding.vue</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;template>
  &lt;div class="ion-item-sliding item-wrapper"
       @touchstart="onDragStart"
       @touchend="onDragEnd"
       @touchmove="onDragMove"
       :class="activeClass">
    &lt;slot>&lt;/slot>
  &lt;/div>
&lt;/template>
&lt;style lang="scss">&lt;/style>
&lt;script type="text/ecmascript-6">
  /**
   * 组件说明：
   * 对外事件：
   * ionDrag - 拖动时触发
   * ionSwipe - 滑动超过按钮最大距离+SWIPE_MARGIN时触发，不管方向
   * ionSwipeRight - 向右滑动 超过按钮最大距离+SWIPE_MARGIN时触发
   * ionSwipeLeft - 向左滑动 超过按钮最大距离+SWIPE_MARGIN时触发
   * */
  import { swipeShouldReset } from '../../util/util'
  import { pointerCoord } from '../../util/dom.js'
  const SWIPE_MARGIN = 30 * 2; // 触发swipe的值
  const ELASTIC_FACTOR = 0.55;
  const ItemSideFlags = {
    None: 0,
    Left: 1,
    Right: 2,
    Both: 3,
  };
  const SlidingState = {
    Disabled: 2,
    Enabled: 4,
    Right: 8,
    Left: 16,
    SwipeRight: 32,
    SwipeLeft: 64,
  };

  let startCood;

  export default{
    name: 'ItemSliding',
    data(){
      return {
        itemInstance: null,// 子组件item的实例
        openAmount: 0,// 开启值 number
        startX: 0, // 初始的位置 number
        optsWidthRightSide: 0, // 右边选项的宽度 number
        optsWidthLeftSide: 0, // 左边选项的宽度 number
        sides: 0, // 当前滑动的方向 ItemSideFlags的枚举值 标识options的left/right/both的状态
        timer: null, // setTimeout的定时器 number 控制关闭时的class
        leftOptions: null, // 左边的选项 实例
        rightOptions: null, // 右边的选项 实例
        optsDirty: true, // boolean true:还未计算options的宽度，false:已计算
        state: SlidingState.Disabled, // 当前状态 SlidingState的枚举值
        firstCoordX: 0, //number 记录点击开始的位置，用于计算速度
        firstTimestamp: new Date().getTime(), //number 记录点击开始的时间，用于计算速度
        activeClass: {}, // 根据滑动状态设置active的class类型
      }
    },
    props: {},
    watch: {},
    computed: {},
    methods: {

      /**
       * onDragStart
       * @param {any} ev
       */
      onDragStart(ev){
        // ev.preventDefault();
        startCood = pointerCoord(ev);
        console.log('coord')
        console.log(startCood)
        this.firstCoordX = startCood.x;
        this.firstTimestamp = new Date().getTime();
        this._startSliding(this.firstCoordX);
        this.$eventBus.$emit('ionSlidingClose', this)
      },

      /**
       * onDragMove
       * @param {any} ev
       */
      onDragMove(ev){
        // ev.preventDefault();
        let coordX = pointerCoord(ev).x;
        this._moveSliding(coordX);
      },

      /**
       * onDragEnd
       * @param {any} ev
       */
      onDragEnd(ev){
        let coordX = pointerCoord(ev).x;
        let deltaX = (coordX - this.firstCoordX);
        let deltaT = (Date.now() - this.firstTimestamp);
        if (deltaX === 0) {
          this.close();
        } else {
          this._endSliding(deltaX / deltaT);
        }
      },

      /**
       * 获取ion-item的开启值
       * @return {number}
       * */
      getOpenAmount() {
        return this.openAmount;
      },

      /**
       * 获取开口的百分比
       * @return {number}
       * */
      getSlidingPercent() {
        let openAmount = this.openAmount;
        if (openAmount > 0) {
          return openAmount / this.optsWidthRightSide;
        } else if (openAmount &lt; 0) {
          return openAmount / this.optsWidthLeftSide;
        } else {
          return 0;
        }
      },

      /**
       * 开启左边的选项卡
       * @return {any} ins - 开启的组件示例的this，默认是当前组件自己的this
       * */
      openLeftOptions(ins = this){
        const _this = this;
        if (ins === _this &amp;&amp; !!_this.leftOptions) {
          _this.activeClass = {
            'active-slide': true,
          };
          _this.$nextTick(function () {
            _this._calculateOptsWidth();
            if (_this.optsWidthLeftSide > 0) {
              _this._setOpenAmount(-_this.optsWidthLeftSide, false)
            }
          })
        }
      },

      /**
       * 开启右边的选项卡
       * @return {any} ins - 开启的组件示例的this，默认是当前组件自己的this
       * */
      openRightOptions(ins = this){
        const _this = this;
        if (ins === _this &amp;&amp; !!_this.rightOptions) {
          _this.activeClass = {
            'active-slide': true,
          };
          _this.$nextTick(function () {
            _this._calculateOptsWidth();
            if (_this.optsWidthRightSide > 0) {
              _this._setOpenAmount(_this.optsWidthRightSide, false)
            }
          })
        }
      },

      /**
       * 关闭当前的sliding
       * */
      close() {
        // 关闭的条件：必须是开启状态，并且不是disable状态
        if (Math.abs(this.openAmount) > 0 &amp;&amp; this.state != SlidingState.Disabled) {
          this._setOpenAmount(0, true);
        }
      },

      /**
       * 获取方向
       */
      _getDirection(coordStart, coordEnd){
        let _dx = Math.abs(coordEnd.x - coordStart.x);
        let _dy = Math.abs(coordEnd.y - coordStart.y);
        if (_dy > _dx) {
          if (coordEnd.y > coordStart.y) {
            return 'bottom'
          } else {
            return 'top'
          }
        } else {
          if (coordEnd.x > coordStart.x) {
            return 'right'
          } else {
            return 'left'
          }
        }
      },

      // ------------- @private -------------
      /**
       * 初始化：获取子组件实例，ItemSideFlags状态变更
       * */
      _init(){
        const _this = this;
        // 获取子组件实例
        let side = 0; // ItemSideFlags None=0
        _this.$children.forEach(function (item) {
          if (item.$options._componentTag === 'ion-item') {
            _this.itemInstance = item;
          }
          if (item.$options._componentTag === 'ion-item-options' &amp;&amp; item.side === 'left') {
            _this.leftOptions = item;
            side |= _this._getSides(item)
          }
          if (item.$options._componentTag === 'ion-item-options' &amp;&amp; item.side === 'right') {
            _this.rightOptions = item;
            side |= _this._getSides(item)
          }
        });
        // ItemSideFlags 的状态记录
        _this.sides = side;
        _this.optsDirty = true;

        //  事件注册
        _this.$eventBus.$on('ionSlidingClose', function (ins) {
          if (_this != ins) {
            _this.close();
          }
        })
      },

      /**
       * 设置起始点，因为有原始点与options点
       * @private
       * @param {number} startX
       * */
      _startSliding(startX) {
        const _this = this;
        if (_this.timer) {
          window.clearTimeout(_this.timer);
          _this.timer = null;
        }
        if (_this.openAmount === 0) {
          _this._setState(SlidingState.Enabled);
        }
        _this.startX = startX + this.openAmount;
      },

      /**
       * 计算openAmount，算入阻尼，最后执行ion-item定位
       * @private
       * @param {number} x
       * @return {number}
       */
      _moveSliding(x){
        const _this = this;
        if (_this.optsDirty) {
          _this._calculateOptsWidth();
          return
        }
        let openAmount = (_this.startX - x);
        switch (_this.sides) {
          case ItemSideFlags.Right:
            openAmount = Math.max(0, openAmount);
            break;
          case ItemSideFlags.Left:
            openAmount = Math.min(0, openAmount);
            break;
          case ItemSideFlags.Both:
            break;
          // default: assert(false, 'invalid ItemSideFlags value'); break;
        }

        if (openAmount > _this.optsWidthRightSide) {
          let optsWidth = _this.optsWidthRightSide;
          openAmount = optsWidth + (openAmount - optsWidth) * ELASTIC_FACTOR;

        } else if (openAmount &lt; -_this.optsWidthLeftSide) {
          let optsWidth = -_this.optsWidthLeftSide;
          openAmount = optsWidth + (openAmount - optsWidth) * ELASTIC_FACTOR;
        }
        _this._setOpenAmount(openAmount, false);
        return openAmount;
      },

      /**
       * 松手后的移动特性决定最终停在哪个位置
       * @private
       * @param {number} velocity 移动速度(惯性)
       * @return {number}
       */
      _endSliding(velocity){
        // 松手后的停留点
        let restingPoint = (this.openAmount > 0)
          ? this.optsWidthRightSide
          : -this.optsWidthLeftSide;

        // Check if the drag didn't clear the buttons mid-point
        // and we aren't moving fast enough to swipe open
        let isResetDirection = (this.openAmount > 0) === !(velocity &lt; 0);
        let isMovingFast = Math.abs(velocity) > 0.3;
        let isOnCloseZone = Math.abs(this.openAmount) &lt; Math.abs(restingPoint / 2);
        if (swipeShouldReset(isResetDirection, isMovingFast, isOnCloseZone)) {
          restingPoint = 0;
        }

        this._setOpenAmount(restingPoint, true);

        this._fireSwipeEvent();
        return restingPoint;
      },

      /**
       * 计算子组件的options的宽度
       * @private
       * */
      _calculateOptsWidth() {
        if (!this.optsDirty) {
          return;
        }
        this.optsWidthRightSide = 0;
        if (this.rightOptions) {
          this.optsWidthRightSide = this.rightOptions.width();
        }
        this.optsWidthLeftSide = 0;
        if (this.leftOptions) {
          this.optsWidthLeftSide = this.leftOptions.width();
        }
        this.optsDirty = false;
      },

      /**
       * 获取options子组件的side属性对应的ItemSideFlags值
       * @private
       * @param {any} ins options子组件的实例
       * */
      _getSides(ins) {
        if (ins.side === 'left') {
          return ItemSideFlags.Left;
        } else {
          return ItemSideFlags.Right;
        }
      },

      /**
       * 根据openAmount设置item的开闭位置
       * @private
       * @param {number} openAmount
       * @param {boolean} isFinal
       * */
      _setOpenAmount(openAmount, isFinal) {
        const _this = this;
        if (_this.timer) {
          window.clearTimeout(_this.timer);
          _this.timer = null;
        }
        _this.openAmount = openAmount;

        if (isFinal) {
          _this._setItemTransformX(0);
        } else {
          if (openAmount > 0) {
            let state = (openAmount >= (_this.optsWidthRightSide + SWIPE_MARGIN))
              ? SlidingState.Right | SlidingState.SwipeRight
              : SlidingState.Right;

            _this._setState(state);

          } else if (openAmount &lt; 0) {
            let state = (openAmount &lt;= (-_this.optsWidthLeftSide - SWIPE_MARGIN))
              ? SlidingState.Left | SlidingState.SwipeLeft
              : SlidingState.Left;

            _this._setState(state);
          }
        }
        if (openAmount === 0) {
          _this.timer = setTimeout(() => {
            _this._setState(SlidingState.Disabled);
            _this.timer = null;
          }, 600);

          _this._setItemTransformX(0);
          return;
        }

        _this._setItemTransformX(-openAmount);
        _this.$emit('ionDrag', _this);
      },

      /**
       * @param {SlidingState} state
       * */
      _setState  (state) {
        if (state === this.state) {
          return;
        }
        this.activeClass = {
          'active-slide': (state !== SlidingState.Disabled),
          'active-options-right': !!(state &amp; SlidingState.Right),
          'active-options-left': !!(state &amp; SlidingState.Left),
          'active-swipe-right': !!(state &amp; SlidingState.SwipeRight),
          'active-swipe-left': !!(state &amp; SlidingState.SwipeLeft),
        };
        this.state = state;
      },

      /**
       * 设置子组件ion-item的transformX属性
       * @private
       * @param {number} val
       * */
      _setItemTransformX(val = 0){
        if (!!this.itemInstance) {
          this.itemInstance.$el.style.transform = 'translate3d(' + val + 'px, 0px, 0px)'
        }
      },

      /**
       * 对外发出swipe事件，
       * @private
       * @param {number} val
       * */
      _fireSwipeEvent() {
        if (this.state &amp; SlidingState.SwipeRight) {
          this.$emit('ionSwipe', this)
          this.$emit('ionSwipeLeft', this)
        } else if (this.state &amp; SlidingState.SwipeLeft) {
          this.$emit('ionSwipe', this)
          this.$emit('ionSwipeRight', this)
        }
      },
    },
    mounted () {
      // 此时子组件才初始化完毕
      this._init();
    },
    destroyed(){
      // 组件中，activated和deactivated都不管用
      this.$eventBus.$off('ionSlidingClose');
    },
  }
&lt;/script>
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Mar 15 2017 10:38:12 GMT+0800 (中国标准时间) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

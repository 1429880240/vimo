<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>tabs/tabs.vue - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Modal.html">Modal</a></li></ul><h3>Modules</h3><ul><li><a href="module-Component_ActionSheet.html">Component/ActionSheet</a><ul class='methods'><li data-type='method'><a href="module-Component_ActionSheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="module-Component_ActionSheet.html#~present">present</a></li></ul></li><li><a href="module-Component_Alert.html">Component/Alert</a><ul class='methods'><li data-type='method'><a href="module-Component_Alert.html#~dismiss">dismiss</a></li><li data-type='method'><a href="module-Component_Alert.html#~present">present</a></li></ul></li><li><a href="module-Component_App.html">Component/App</a><ul class='methods'><li data-type='method'><a href="module-Component_App.html#~isEnabled">isEnabled</a></li><li data-type='method'><a href="module-Component_App.html#~isScrolling">isScrolling</a></li><li data-type='method'><a href="module-Component_App.html#~setDisableScroll">setDisableScroll</a></li><li data-type='method'><a href="module-Component_App.html#~setEnabled">setEnabled</a></li><li data-type='method'><a href="module-Component_App.html#~setTitle">setTitle</a></li></ul></li><li><a href="module-Component_Backdrop.html">Component/Backdrop</a></li><li><a href="module-Component_Content.html">Component/Content</a><ul class='methods'><li data-type='method'><a href="module-Component_Content.html#~getContentDimensions">getContentDimensions</a></li><li data-type='method'><a href="module-Component_Content.html#~resize">resize</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollTo">scrollTo</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollToBottom">scrollToBottom</a></li><li data-type='method'><a href="module-Component_Content.html#~scrollToTop">scrollToTop</a></li></ul></li><li><a href="module-Component_Footer.html">Component/Footer</a></li><li><a href="module-Component_Grid.html">Component/Grid</a></li><li><a href="module-Component_Header.html">Component/Header</a></li><li><a href="module-Component_Icon.html">Component/Icon</a></li><li><a href="module-Component_Img.html">Component/Img</a></li><li><a href="module-Component_InfiniteScroll.html">Component/InfiniteScroll</a><ul class='methods'><li data-type='method'><a href="module-Component_InfiniteScroll.html#~complete">complete</a></li><li data-type='method'><a href="module-Component_InfiniteScroll.html#~enable">enable</a></li><li data-type='method'><a href="module-Component_InfiniteScroll.html#~waitFor">waitFor</a></li></ul></li><li><a href="module-Component_Label.html">Component/Label</a></li><li><a href="module-Component_Loading.html">Component/Loading</a></li><li><a href="module-Component_Refresher.html">Component/Refresher</a><ul class='methods'><li data-type='method'><a href="module-Component_Refresher.html#~cancel">cancel</a></li><li data-type='method'><a href="module-Component_Refresher.html#~complete">complete</a></li></ul></li><li><a href="module-Component_Spinner.html">Component/Spinner</a></li><li><a href="module-Component_Tab.html">Component/Tab</a></li><li><a href="module-Component_Tabs.html">Component/Tabs</a><ul class='methods'><li data-type='method'><a href="module-Component_Tabs.html#~getActivatedIndex">getActivatedIndex</a></li><li data-type='method'><a href="module-Component_Tabs.html#~getByIndex">getByIndex</a></li><li data-type='method'><a href="module-Component_Tabs.html#~getSelected">getSelected</a></li><li data-type='method'><a href="module-Component_Tabs.html#~select">select</a></li></ul></li><li><a href="module-Component_Toast.html">Component/Toast</a></li><li><a href="module-Component_Toggle.html">Component/Toggle</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:onInfinite">onInfinite</a></li><li><a href="global.html#event:onScroll">onScroll</a></li><li><a href="global.html#event:onScrollEnd">onScrollEnd</a></li><li><a href="global.html#event:onScrollStart">onScrollStart</a></li></ul><h3>Global</h3><ul><li><a href="global.html#dismiss">dismiss</a></li><li><a href="global.html#getAnInstance">getAnInstance</a></li><li><a href="global.html#Input/Textarea">Input/Textarea</a></li><li><a href="global.html#present">present</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">tabs/tabs.vue</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;template>
    &lt;article class="ion-tabs tabs" :class="[modeClass,colorClass]" :tabsLayout="tabsLayout"
             :tabsHighlight="tabsHighlight">
        &lt;section class="tabs-content" ref="tabsContent">
            &lt;!--tabbar-->
            &lt;div class="tabbar" role="tablist" ref="tabbar" :tabsLayout="tabsLayout">
                &lt;slot name="tab">&lt;/slot>
                &lt;div ref="tabHighlight" class="tab-highlight">&lt;/div>
            &lt;/div>
            &lt;!--tabs-content-wrap-->
            &lt;div ref="tabsContentWrap" class="tabs-content-wrap">
                &lt;section class="wrap-inner">
                    &lt;slot>&lt;/slot>
                &lt;/section>
            &lt;/div>
        &lt;/section>
    &lt;/article>
&lt;/template>
&lt;style lang="scss">
    @import "./tabs.scss";
    @import "./tabs.ios.scss";
    @import "./tabs.md.scss";
&lt;/style>
&lt;script type="text/ecmascript-6">
  /**
   * @module Component/Tabs
   * @description
   * ----
   * Tabs是一个使用`$router.replace`进行页面导航的组件，其中Tab组件中传入`props`定义每个tab的结构/样式/路由位子等信息。
   *
   * Tabs使用场景类似于"栏目切换"， 如果你使用的是IOS手机，请参考"App Store"应用。下图也许能更直观的表达Tabs的职责范围。
   *
   * ![tabs的设计](../asset/tabs.png)
   *
   * Tabs中嵌入的自路由页面应该是不包含Navbar组件的Page页面，可以包括Footer和Header，这个由业务确定。
   *
   * Tabs组件是使用规则如下：
   *
   * 1. Tabs和Tab必须组合使用
   * 2. Tab组件需要增加`slot="tab"`插槽标记
   * 3. Tabs组件必须在Page组件中，而且子路由也是一个Page包裹的页面
   * 4. 页面路由插槽`&lt;router-view>&lt;/router-view>`写在Tabs中，是否开启`keep-alive`由业务自己决定
   * 5. 页面进入究竟激活那个子页面由路由规则`route.js`决定
   * 6. `tabsHighlight`特性只能在`md`模式下使用
   *
   * ##### Slots
   * - tab - Tab组件的插槽
   *
   * @fires onTabChange - 当切换Tab时触发
   *
   *
   * @property {String=} color                        - 颜色
   * @property {String} [mode='ios']                  - 模式
   * @property {Boolean} [tabsHighlight='false']      - tab下面是否显示选中bar
   * @property {String} [tabsLayout='icon-top']       - tabbar的样式，可选配置: icon-top, icon-left, icon-right, icon-bottom, icon-hide, title-hide.
   * @property {String} [tabsPlacement='bottom']      - tabbar的位置，可选配置: top, bottom
   *
   * @example
   *
   &lt;Page>
   &lt;Tabs tabsLayout="icon-top" tabsPlacement="bottom" @onTabChange="onTabChange" ref=tabs>
   &lt;router-view>&lt;/router-view>
   &lt;Tab slot="tab" :to="{name:'tabsBottom.demoTab1'}" tabBadge="13" tabTitle="User" tabBadgeStyle="danger" tabIcon="person">&lt;/Tab>
   &lt;Tab slot="tab" :to="{name:'tabsBottom.demoTab2'}" tabBadge="2" tabTitle="Cars" tabBadgeStyle="dark" tabIcon="car">&lt;/Tab>
   &lt;Tab slot="tab" :to="{name:'tabsBottom.demoTab3'}" tabBadge="7" tabTitle="Star" tabIcon="star" :enabled="true">&lt;/Tab>
   &lt;/Tabs>
   &lt;/Page>
   *
   * @example
   *
   computed: {
     tabs(){
      // 获取tabs的实例
      return this.$refs.tabs
     }
   },
   methods: {
      onTabChange(index){
        console.debug('事件 -> onTabChange-selectedIndex:' + index);
        console.debug('当前选择index的tab实例:')
        console.debug(this.tabs.getByIndex(index))
        console.debug('获取当前在激活状态的tab实例:')
        console.debug(this.tabs.getSelected())
        console.debug('由Tabs组件获取当前激活的index:' + this.tabs.getActivatedIndex());

        console.debug('3s后选择第一个')
        clearTimeout(this.timer)
        this.timer = setTimeout(()=>{
          this.tabs.select(0)
        },3000)
      },
    },
   *
   * */
  import { parsePxUnit, firstUpperCase } from '../../util/util'
  import { setElementClass } from '../../util/dom'
  export default{
    name: 'Tabs',
    props: {
      color: {
        type: String,
        default: ''
      },
      mode: {
        type: String,
        default(){ return window.VM &amp;&amp; window.VM.config.get('mode', 'ios') || 'ios' }
      },
      // tab下面是否显示选中bar
      tabsHighlight: {
        type: Boolean,
        default(){ return window.VM &amp;&amp; window.VM.config.getBoolean('tabsHighlight', false)}
      },
      // tabbar的样式: icon和title的放置位置
      // 可选配置: icon-top, icon-left, icon-right, icon-bottom, icon-hide, title-hide.
      tabsLayout: {
        type: String,
        default: 'icon-top',
      },
      // tabbar的位置 top, bottom
      tabsPlacement: {
        type: String,
        default: 'bottom',
      },

    },
    data(){
      return {
        isInit: false, // 当前组件初始化状态
        tabElementWidth: 0, // 每个tab的宽度, 用于tabHighLight
        tabSlots: null,
        tabbarElement: null, // tabbar元素
        tabsContentElement: null,
        tabsContentWrapElement: null,
        tabHighlightEle: null, // TabHighlight元素
        selectedIndex: -1, // 内部使用的, 表示当前处于激活的Tab的index
        statusbarPadding: VM.config.getBoolean('statusbarPadding', false), // 是否有statusbar的padding
      }
    },
    watch: {
      $route(){
        if (!this.isInit) return;
        let _index = this.getActivatedIndex();
        if (this.selectedIndex !== _index) {
          this.selectedIndex = _index;
          this.tabHighlightSelect(this.selectedIndex)
          this.$emit('onTabChange', _index)
        }
      }
    },
    computed: {
      // 环境样式
      modeClass () {
        return `tabs-${this.mode}`
      },
      // 颜色
      colorClass () {
        return !!this.color ? (`tabs-${this.mode}-${this.color}`) : ''
      },
    },
    methods: {
      // ------ public ------
      /**
       * @function getByIndex
       * @description
       * 获取第几个index的Tab组件实例
       * @param {number} index - 第几个index
       * @return {Tab}
       * */
      getByIndex(index){
        if (!!this.tabSlots[index]) {
          return this.tabSlots[index].componentInstance
        }
      },

      /**
       * @function getActivatedIndex
       * @description
       * 获取当前被选中Tab实例的index
       * @return {number}
       * */
      getActivatedIndex(){
        for (let i = 0, len = this.tabSlots.length; len > i; i++) {
          let tabIns = this.tabSlots[i].componentInstance;
          if (tabIns.to.name === this.$route.name || tabIns.to.path === this.$route.path) {
            return i
          }
        }
        return 0
      },

      /**
       * @function getSelected
       * @description
       * 获取当前选中的Tab实例
       * @return {Tab}
       * */
      getSelected(){
        return this.getByIndex(this.getActivatedIndex())
      },

      /**
       * @function select
       * @description
       * 根据传入值选中Tab
       * @param {number/Tab} tabOrIndex - 传入的Tab实例或者Tab的序号
       * @return {Tab}
       * */
      select(tabOrIndex){
        let tabIns = tabOrIndex;
        if (typeof tabOrIndex === 'number') {
          tabIns = this.getByIndex(tabOrIndex)
        }
        if (tabIns === this.getSelected()) {
          return tabIns
        } else {
          this.$router.replace(tabIns.to);
          return tabIns
        }
      },

      // ------ private ------

      /**
       * 获取每个tab的宽度, 因为是平均, 故用除法就行
       * */
      getTabElementWidth(){
        let _count = this.tabSlots.length;
        let _warpWidth = this.tabbarElement.offsetWidth;
        return _warpWidth / _count
      },

      /**
       * 第一次进入是的初始化,
       */
      initTabs(){
        if (this.isInit) return;

        // 获取tabbar元素
        this.tabSlots = this.$slots.tab;
        this.tabbarElement = this.$refs.tabbar;
        this.tabElementWidth = this.getTabElementWidth();
        this.selectedIndex = this.getActivatedIndex();

        this.tabHighlightEle = this.$refs.tabHighlight;
        this.tabsContentElement = this.$refs.tabsContent;
        this.tabsContentWrapElement = this.$refs.tabsContentWrap;

        // 计算属性盒子的尺寸
        this.computeTabsContentStyle();
        this.computeTabsContentWrapStyle();

        // 激活当前选中的Highlight
        if (this.tabsHighlight) {
          this.tabHighlightSelect(this.selectedIndex)
        }

        this.isInit = true
      },

      /**
       * 计算stabs-content的样式
       * 因为这部分首一下因素影响：statusbarPadding、fullscreen、Header，Footer
       * */
      computeTabsContentStyle () {
        let _styleType = 'margin';
        let headerBarHeight = 0;
        let footerBarHeight = 0;
        let computedStyle;
        let children = this.$parent.$children;
        let ele;
        let tagName;

        children.forEach((child) => {
          ele = child.$el;
          tagName = child.$options._componentTag.toLowerCase();
          if (tagName === 'header') {
            // this.headerElement = ele;
            computedStyle = getComputedStyle(ele);
            headerBarHeight = parsePxUnit(computedStyle.height);
          } else if (tagName === 'footer') {
            // this.footerElement = ele;
            computedStyle = getComputedStyle(ele);
            footerBarHeight = parsePxUnit(computedStyle.height);
          }
        });

        if (this.statusbarPadding) {
          headerBarHeight = headerBarHeight + 20;
        }

        if (headerBarHeight > 0) {
          this.tabsContentElement.style.marginTop = headerBarHeight + 'px';
        }
        if (footerBarHeight > 0) {
          this.tabsContentElement.style.marginBottom = footerBarHeight + 'px';
        }
      },

      /**
       * 计算stabs-content-wrap的样式
       * 这部分的因素影响：tabbar的位置及高度
       * */
      computeTabsContentWrapStyle(){
        let tabBarHeight = getComputedStyle(this.tabbarElement).height;
        tabBarHeight = parsePxUnit(tabBarHeight)
        let _styleType = 'margin' + firstUpperCase(this.tabsPlacement);
        if (tabBarHeight > 0) {
          this.tabsContentWrapElement.style[_styleType] = tabBarHeight + 'px';
        }
        this.setTabbarPosition(this.tabsPlacement);
      },

      /**
       * 给TabBar定位
       * @param {string} position - top, bottom
       */
      setTabbarPosition(position) {
        position = !!position &amp;&amp; position.toLowerCase();
        if (position === 'bottom') {
          this.tabbarElement.style.bottom = '0px';
          this.tabbarElement.style.top = 'auto';
        } else {
          this.tabbarElement.style.top = '0px';
          this.tabbarElement.style.bottom = 'auto';
        }
        this.tabbarElement.classList.add('show-tabbar');
      },

      /**
       * 下滑线定位
       * @param {number} index
       */
      tabHighlightSelect(index){
        if (this.mode !== 'md') return
        let _offsetLeft = this.tabElementWidth * index;
        let transform = `translate3d(${_offsetLeft}px,0,0) scaleX(${this.tabElementWidth})`;
        setElementClass(this.tabHighlightEle, 'animate', true);
        this.tabHighlightEle.style[VM.platform.css.transform] = transform;
      },
    },
    mounted () {
      console.assert(this.$parent.$options._componentTag.toLowerCase() === 'page', 'Tabs component must place in Page Component');
      // 初始化
      this.initTabs();
    },
  }
&lt;/script>
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Mar 22 2017 21:00:31 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
